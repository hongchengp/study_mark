# 线程池



## 任务队列

它是存放要被执行的队列

它是多线程共享的，要上锁的



### 空时

如果空了，就不能取任务了，知道有任务放入时

所以应该用条件变量（放入时，就empty_conn.notify()）

条件变量可以说是线程间的通信



### 满时

满了，就不能再放了，直到有任务取出

同上（full_conn.notify()）



## 线程队列

你也是多线程共享的，也要上锁

存储线程的

如果任务太多，线程数少于max

就新建线程，否则加入任务队列

如果任务队列也满了，怎么办

可以用放弃策略，就是回调函数，用户自定义的，符合接口规范就可以



如果有线程很长时间没有工作，应该让他死亡



### 什么时候用线程池

1. 要开的线程数太多时，防止线程切换的开销
2. 计算密集型用线程池来优化
3. 如果用协程，还要不要线程池，如果计算密集型还是要的

