# 分布式



## 基础概念 

**分布式**（Distributed）指的是一种计算架构，其中任务和数据被分散到多个独立的计算节点上，这些节点可以在不同的物理位置上运行。分布式系统的目标是通过协调和合作，使各个节点能够共同完成复杂的计算任务或提供服务，从而提高系统的**性能**（数据多 & 并发高）、**可扩展性**（一致性hash & 发现和注册中心）和**可靠性**（高可用性）。





## CAP理论



### 可用性

可用性指的是系统在某个时间段内能够正常响应用户请求的能力。高可用性意味着系统即使在**发生故障**时，仍能继**续提供服务**。



### 分区容忍性（Partition Tolerance）

分区容忍性是指在网络分区发生时，系统能够继续正常运行并对用户请求作出响应的能力。**网络分区是指系统中的某些节点之间由于网络故障而无法进行通信**。 重点是无法通信



### 一致性

多个节点间的数据一样。（和数据库的一致性不同，是副本一致性）







## 应用



### 大量数据

如果数据非常多，可以用分布式。（和mysql的分库分表一样，redis也可以，都是用hash + 扰动函数（数据分布更均匀） + mod）

分片键要选好（频繁使用的，而且是不能变化的）

这个好像不用考虑数据的一致性，因为数据只会在一个节点上，没有副本。
但是没有副本，就要考虑容灾备份 和 高可用性。

可以让有副本数据，但是这样就引入了一致性问题。

如果 节点数量改变，会造成 缓存雪崩，用一致性hash来解决。一致性hash 解决 节点数量改变，key 映射 到不同 节点问题。



###  高流量

这个就是数据库的分库（因为一个节点的连接池是有限的，一个不够用，就用分布式）很像，但是不是。它是数据在多个节点存储。



用的是主从分离。主数据库用来写数据，从数据库用来读数据。提高并发度。

但是主从一致性怎么办

**mysql用的是binlog**。主数据库 写了数据，then 写入binlog，then binlog同步给从数据库，then从数据库更新。

**redis用的是 rdb & aop**，aop和数据库的 undolog很像，都是逻辑日志，可以增量更新，不用完全的更新。

而且可以解决数据备份，写阻塞问题。

**我们可以阻塞从数据库，备份从数据，让主数据依旧可以写。但是会有数据的丢失**（在两次备份间，主数据库故障，主数据库数据的丢失）。



### 高可用性

多个节点，一个坏了，可用用别的。

但是多个节点就会带来数据的一致性问题





## 引入问题



### 一致性

副本一致性



### 复杂性

比如说，节点的管理master、slave。

引入了管理节点

**服务注册与发现中心** （解决节点动态扩展问题，让节点和节点 解耦，）

让**节点与节点解耦**，而且增加了**可扩展性**，因为**服务只用和中心交互**，而**中心暴露的接口是高度抽象的**，

不太容易变化，而且服务的注册只需要用**网路IO**，发现也是用网络IO（发现应该是中心的回调函数），

这些网路IO都是抽象接口，也是不会变化。

但是引入了单点故障啊，如果中心寄了怎么办。嘿嘿嘿，也用分布式，增加几个节点呗，但是也引入了分布式的问题（一致性）



### 延迟性

延迟性，如果用到了网络通信，就会带来延迟

而且有网路IO，那就可以用连接池来优化





## key

高流量 （提高性能） ，高存储（分片），高可用（容灾备份等等）

